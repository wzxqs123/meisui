<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>万圣节活动</title>
        <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
        <meta name="format-detection" content="telephone=no">
        <link rel="stylesheet" type="text/css" href="http://dw.txzb888.com/activitys.css">
        <style type="text/css">
            html, body {
                background: #000;
            }
        </style>
    </head>
    <body>
        <div class="turntable-wrap position-rel">
            <header class="turntable-head turntable-yellow twenty-four text-center">10月27日 00:00:00-10月31日 24:00:00 </header>
            <!-- 转盘 -->
            <!-- <div class="position-rel" style="z-index:2;width:21.32rem;height:21.32rem;margin: 0 auto;background-color:#f2b354;border-radius:50%;"></div> -->
            <div class="main position-rel">
                <div class="wrap position-rel">
                    <div class="frame">
                        <div class="circle">
                            <p class="position-rel" data-lottery="0">
                            </p>
                            <p class="position-rel" data-lottery="1">
                            </p>
                            <p class="position-rel" data-lottery="2">
                            </p>
                            <p class="position-rel" data-lottery="3">
                            </p>
                            <p class="position-rel" data-lottery="4">
                            </p>
                            <p class="position-rel" data-lottery="5">
                            </p>
                            <p class="position-rel" data-lottery="6">
                            </p>
                            <p class="position-rel" data-lottery="7">
                            </p>
                            <p class="position-rel" data-lottery="8">
                            </p>
                            <p class="position-rel" data-lottery="9">
                            </p>
                        </div>
                        <div class="button">
                            <button></button>
                            <p></p>
                        </div>
                    </div>
                    <div class="bubbles">
                        <span></span>
                        <span></span>
                        <span></span>
                        <span></span>
                        <span></span>
                        <span></span>
                        <span></span>
                        <span></span>
                        <span></span>
                        <span></span>
                        <span></span>
                        <span></span>
                    </div>
                    <mark class="white"></mark>
                    <div class="dialog">
                        <p></p>
                        <button>确定</button>
                    </div>
                </div>
                <div class="particle">
                    <span></span>
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
                <div class="luck-draw-tipalert position-abs text-center thirty-two none">大奖正在来的路上</div>
            </div>

            <section class="turntable-sec">
                <div class="turntable-frequency text-center weight-bold turntable-yellow">抽奖次数：&nbsp&nbsp<span>10</span></div>
                <div class="turntable-but">
                    <a class="white block" href=""></a>
                    <!-- <a class="left" href=""></a> -->
                </div>
                <div class="turntable-winning turntable-red text-center">
                    <div class="turntable-winhead thirty-two weight-bold clearfix">
                        <span class="left">用户昵称</span>
                        <span class="left">获得奖品</span>
                    </div>
                    <div id="turntable-winuser" class="turntable-winuser twenty-six">
                        <ol id="turntable-winusercom" class="turntable-winusercom">
                            <li class="clearfix">
                                <span class="left">斯巴达1</span>
                                <span class="left">3666钻石</span>
                            </li>
                            <li class="clearfix">
                                <span class="left">斯巴达2</span>
                                <span class="left">3666钻石</span>
                            </li>
                            <li class="clearfix">
                                <span class="left">斯巴达3</span>
                                <span class="left">3666钻石</span>
                            </li>
                            <li class="clearfix">
                                <span class="left">斯巴达4</span>
                                <span class="left">3666钻石</span>
                            </li>
                            <li class="clearfix">
                                <span class="left">斯巴达1</span>
                                <span class="left">3666钻石</span>
                            </li>
                            <li class="clearfix">
                                <span class="left">斯巴达2</span>
                                <span class="left">3666钻石</span>
                            </li>
                            <li class="clearfix">
                                <span class="left">斯巴达3</span>
                                <span class="left">3666钻石</span>
                            </li>
                            <li class="clearfix">
                                <span class="left">斯巴达4</span>
                                <span class="left">3666钻石</span>
                            </li>
                        </ol>
                    </div>
                </div>
                <div class="turntable-rule turntable-red">
                    <ol>
                        <li>1.&nbsp&nbsp活动期间:10月27日 -10月31日，用户每天登陆即可获得一次抽奖机会。</li>
                        <li>2.&nbsp&nbsp用户每赠送一个特定“爱心”礼物，即可享受额外一次转盘抽奖活动，次数上不封顶。</li>
                        <li>3.&nbsp&nbsp特别提示：抽取到iPhone 8 苹果手机的用户，请在抽奖记录界面截图，联系官方客服，进行核对、发放。</li>
                    </ol>
                    <div>本活动最终解释权归天香直播所有。</div>
                </div>
            </section>
            <!-- 弹窗 -->
            <div class="turntable-alertbg position-fix none">
                <div class="turntable-alert bg-white text-center position-abs">
                    <em class="turntable-close position-abs"></em>
                    <!-- 弹窗内容 -->
                    <img class="block none" src="http://dw.txzb888.com/pic11.png" alt="" />
                    <p class="turntable-nofrequency thirty turntable-red"></p>
                    <span class="block"></span>
                </div>
            </div>
        </div>
        <script src="http://dw.txzb888.com/jquery-1.11.3.min.js" type="text/javascript"></script>
        <script src="http://dw.txzb888.com/index.js" type="text/javascript"></script>
        <script>
            var luckMain = document.getElementById("turntable-winuser");
            var luckSpeed = 5;
            var luckScroll = setInterval(function(){
                luckMain.scrollTop += luckSpeed;
                if (luckMain.scrollTop + $("#turntable-winuser").height() >= $("#turntable-winusercom").height()) {
                    clearInterval(luckScroll);
                }
            },300);

            // 关闭弹窗
            function turntClose (butEve, alert, none) {
                $(butEve).click(function () {
                    $(alert).addClass(none);
                    // 解除滚动条锁定
                    relievescroll();
                })
            }
            // 点击确定按钮关闭弹窗
            turntClose(".turntable-alert span", ".turntable-alertbg", "none");
            // 点击关闭按钮关闭弹窗
            turntClose(".turntable-close", ".turntable-alertbg", "none");
            // 点击弹窗空白部分隐藏弹窗
            freeBlank(".turntable-alertbg", ".turntable-alert", "none")

            $(function(){
                //var radius = $(window).width()/3;//半径
                var sum = 10;
                var loterry;//中奖的index,可将luckDrawArr[0]赋予loterry便是单抽的结果
                var minRotate = 2160;//最少转动角度
                var rotate = 0;
                var duration = 5;
                var $items = $(".circle p");
                var light = 0;
                var showTime,loterryTime,bubblesInterval;
                //var borderWidth = radius*Math.tan(360/sum/2*Math.PI/180);
                // $(".circle").css("width",radius*2+"px").css("height",radius*2+"px");
                $(".circle p").each(function(){
                   // $(this).css("border-width",radius+"px "+borderWidth+"px 0px "+borderWidth+"px");
                    //$(this).css("left",radius-borderWidth+"px");
                    var jiao = $(this).index()*360/sum;
                    $(this).css("transform","rotate("+jiao+"deg)");
                    //$(this).css("transform-origin",borderWidth+"px "+radius+"px");
                });
                // 点击单抽按钮
                function luckPumpBut (butEve, pumpEve) {
                    $(butEve).click(function(){
                        var turntCishu = parseInt($(".turntable-frequency span").html());
                        if (turntCishu <= 0) {
                            $(".turntable-alertbg").removeClass("none");
                            $(".turntable-alert img").addClass("none");
                            $(".turntable-alert p").addClass("turntable-nofrequency").removeClass("turntable-red").html("抽奖次数已用完，送主播3666爱心可以获得一次抽奖机会哟！");
                            // 锁定滚动条
                            lockscroll();
                        } else {
                            /*$.ajax({
                                url: 'http://l1o7025041.imwork.net:13870/bigTurnTable/turnTableDraw',
                                type: 'get',
                                dataType: 'json',
                                async: false,
                                success: function (data) {
                                    loterry = data.id;
                                    console.log(loterry);
                                }
                            })*/
                            // 剩余次数减一，并显示
                            turntCishu--;
                            $(".turntable-frequency span").html(turntCishu);

                            $(this).addClass("disabled");
                            // loterry;
                            loterry = Math.floor(Math.random()*sum);//测试，随机一位数，为获奖的序号
                            rotate = rotate-rotate%360+minRotate+360-loterry*360/sum;//需要转动的角度
                            $(".circle").css("transform","rotate("+rotate+"deg)");
                            $(".circle").css("transition-duration",duration+"s");
                            $("body").addClass("playing");
                            pumpEve();
                            setTimeout(function(){
                                $("body").addClass("animate");
                            },1000);
                            setTimeout(function(){
                                $("body").removeClass("animate");
                            },duration*1000-1000);
                            loterryLight();
                            bubbles();
                        }

                    });
                    
                }
                luckPumpBut(".button", luckSinglePump);
                // 单抽转盘转动函数
                function luckSinglePump () {
                    setTimeout(function(){
                        /*if($items.eq(loterry).attr('data-lottery')){
                            dialog(true,"恭喜你中了"+$items.eq(loterry).attr('data-lottery')+"等奖");
                        }else{
                            dialog(true,"很遗憾你没有中奖");
                        }*/
                        /*0：3666钻
                        1：Iphone8
                        2：100钻
                        3：天香账号经验+500
                        4：300钻
                        5：天香账号经验+300
                        6：20钻
                        7：天香账号经验+200
                        8：50钻
                        9：天香账号经验+100*/
                        var luckObtainNumber = $items.eq(loterry).attr('data-lottery');
                        // console.log($items.eq(loterry).attr('data-lottery'));
                        
                        $(".turntable-alertbg").removeClass("none");
                        $(".turntable-alert img").removeClass("none");
                        $(".turntable-alert p").addClass("turntable-red").removeClass("turntable-nofrequency");
                        if (luckObtainNumber == 0) {
                            $(".turntable-alert p").html("恭喜您获得了3666钻！")
                        } else if(luckObtainNumber == 1) {
                            $(".turntable-alert p").html("恭喜您获得了华为P10！")
                        } else if(luckObtainNumber == 2) {
                            $(".turntable-alert p").html("恭喜您获得了100钻！")
                        } else if(luckObtainNumber == 3) {
                            $(".turntable-alert p").html("恭喜您获得了经验+500！")
                        } else if(luckObtainNumber == 4) {
                            $(".turntable-alert p").html("恭喜您获得了300钻！")
                        } else if(luckObtainNumber == 5) {
                            $(".turntable-alert p").html("恭喜您获得了经验+300！")
                        } else if(luckObtainNumber == 6) {
                            $(".turntable-alert p").html("恭喜您获得了20钻！")
                        } else if(luckObtainNumber == 7) {
                            $(".turntable-alert p").html("恭喜您获得了经验+200！")
                        } else if(luckObtainNumber == 8) {
                            $(".turntable-alert p").html("恭喜您获得了50钻！")
                        } else if(luckObtainNumber == 9) {
                            $(".turntable-alert p").html("恭喜您获得了经验+100！")
                        }
                        // 锁定滚动条
                        lockscroll();

                        bubblesInterval&&clearInterval(bubblesInterval);
                        $(".button").removeClass("disabled");
                        $("body").removeClass("playing");
                    },duration*1000);
                }

                function show(){
                    loterryTime&&clearInterval(loterryTime);
                    bubblesInterval&&clearInterval(bubblesInterval);
                    showTime = setInterval(function(){
                        light = light%sum;
                        $items.removeClass("light");
                        $items.eq(light).addClass("light");
                        $items.eq((light+sum/2)%sum).addClass("light");
                        light++;
                    },500);
                }
                // show();
                function loterryLight(){
                    showTime&&clearInterval(showTime);
                    var step;//到达中奖的区域 需要移动的步数
                    if(light>=loterry){
                        step = loterry+sum-light;
                    }else{
                        step = loterry-light;
                    }
                    var stepAll = step+3*sum;
                    var time = (duration*1000-500)/stepAll;
                    lightAnimate(time,stepAll)();
                }
                function bubbles(){
                    var $bubbles = $(".bubbles span");
                    var index = 0;
                    bubblesInterval = setInterval(function(){
                        index = index%($bubbles.length);
                        $bubbles.removeClass("light");
                        $bubbles.eq(index).addClass("light");
                        index++;
                    },1.5/12*1000);
                }
                function lightAnimate(time,stepAll){
                    var step = 0,lightInterval;
                    return function(){
                        lightInterval = setInterval(function(){
                            light = light%sum;
                            $items.removeClass("light");
                            $items.eq(light).addClass("light");
                            if(step == stepAll){//已经转动到了中奖项
                                clearInterval(lightInterval);
                            }
                            light++;
                            step++;
                        },time);
                    };
                }
                $(".dialog button").click(function(){
                    dialog(false);
                });
                function dialog(bool,txt){
                    if(bool){
                        $(".dialog").removeClass("hide").addClass("show").find("p").html(txt);
                    }else{
                        $(".dialog").removeClass("show").addClass("hide");
                    }
                }
            });
        </script>
    </body>
</html>