<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>美岁年终盛典</title>
        <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
        <meta name="format-detection" content="telephone=no">
        <link rel="stylesheet" type="text/css" href="css/activitys.css">
        <style type="text/css">
            html, body {
                width: 100%;
                background: #091223;
            }
            .year-e-wrap .none {
                display: none;
            }
        </style>
    </head>
    <body>
        <div class="year-e-wrap position-rel">
            <div class="year-e-head">
                <img class="block img" src="images/demoimages/pic195_2.png" alt="" />
            </div>
            <div class="year-e-play position-rel">
                <!-- poster为视频封面 -->
                <video id="year-e-playvideo" class="year-e-playvideo block img" playsinline="true" webkit-playsinline="true">
                    <source type="video/mp4" src="media/year-end-one.m4v">
                </video>
                <span class="year-e-playbut position-abs"></span>
                <strong class="year-e-vrate position-abs block">
                    <em class="block"></em>
                </strong>
            </div>
            <!-- 列表模块 -->
            <div class="year-e-listmodule">
                <div class="year-e-lmnav">
                    <!-- 选中项添加year-e-lmnavitemsel -->
                    <div class="year-e-lmnavitem year-e-lmnavitemsel text-center" data-type="1">
                        <span class="block twenty-six">阳光女神榜</span>
                        <div class="block position-rel">
                            <em class="position-rel">每日10点-17点</em>
                            <strong class="position-abs"></strong>
                        </div>
                    </div>
                    <div class="year-e-lmnavitem text-center" data-type="0">
                        <span class="block twenty-six">星动女神榜</span>
                        <div class="block position-rel">
                            <em class="position-rel">每周一0点-周日24点</em>
                            <strong class="position-abs"></strong>
                        </div>
                    </div>
                    <div class="year-e-lmnavitem text-center" data-type="2">
                        <span class="block twenty-six">月光女神榜</span>
                        <div class="block position-rel">
                            <em class="position-rel">每日19点-24点</em>
                            <strong class="position-abs"></strong>
                        </div>
                    </div>
                </div>
                <div class="year-e-lmtimemod">
                    <div class="year-e-lmtime white twenty-six text-center position-rel">
                        <div data-week="1">周一</div>
                        <div data-week="2">周二</div>
                        <div data-week="3">周三</div>
                        <div data-week="4">周四</div>
                        <div data-week="5">周五</div>
                        <div data-week="6">周六</div>
                        <div data-week="0">周日</div>
                    </div>
                    <div class="year-e-lmweek white twenty-six text-center position-rel none">
                        <div data-week="0">本周</div>
                        <div data-week="1">上周</div>
                    </div>
                </div>
                <div id="year-e-lmlists" class="year-e-lmlists">
                    <ul id="year-e-lmul" class="year-e-lmul white">
                        <!-- <li class="year-e-lmli">
                            <span class="thirty">1</span>
                            <img class="block" src="images/demoimages/pic48.png" alt="" />
                            <div class="thirty">我叫李依沙白</div>
                            <em class="twenty-six">888888</em>
                        </li>
                        <li class="year-e-lmli">
                            <span class="thirty">1</span>
                            <img class="block" src="images/demoimages/pic48.png" alt="" />
                            <div class="thirty">我叫李依沙白</div>
                            <em class="twenty-six">888888</em>
                        </li>
                        <li class="year-e-lmli">
                            <span class="thirty">1</span>
                            <img class="block" src="images/demoimages/pic48.png" alt="" />
                            <div class="thirty">我叫李依沙白</div>
                            <em class="twenty-six">888888</em>
                        </li>
                        <li class="year-e-lmli">
                            <span class="thirty">1</span>
                            <img class="block" src="images/demoimages/pic48.png" alt="" />
                            <div class="thirty">我叫李依沙白</div>
                            <em class="twenty-six">888888</em>
                        </li>
                        <li class="year-e-lmli">
                            <span class="thirty">1</span>
                            <img class="block" src="images/demoimages/pic48.png" alt="" />
                            <div class="thirty">我叫李依沙白</div>
                            <em class="twenty-six">888888</em>
                        </li>
                        <li class="year-e-lmli">
                            <span class="thirty">1</span>
                            <img class="block" src="images/demoimages/pic48.png" alt="" />
                            <div class="thirty">我叫李依沙白</div>
                            <em class="twenty-six">888888</em>
                        </li> -->
                    </ul>
                    <div class="year-e-lmnostart white thirty text-center none">当日活动未开启，敬请期待</div>
                </div>
            </div>
            <!-- 活动规则 -->
            <div class="year-e-rule">
                <h2 class="year-e-tit position-rel">
                    <div class="white text-center weight-bold position-rel">活动规则</div>
                    <span class="bg-white position-abs"></span>
                </h2>
                <ul class="year-e-ruleul white">
                    <li>1、所有主播在限定时段内进行直播均可参与活动，无需报名自动参与；</li>
                    <li>2、阳光女神：每日10点-17点时段内，按照主播直播间收礼所得星光值进行排名，排名第一的主播和获得对应奖励；</li>
                    <li>3、月光女神：每日19点-24点时段内，按照主播直播间收礼所得星光值进行排名，排名第一的主播和获得对应奖励；</li>
                    <li>4、星动女神：每周一10点-周天23点时段内，按照主播直播间收礼所得星光值进行排名，排名第一的主播和获得对应奖励；</li>
                </ul>
            </div>
            <!-- 主播奖励 -->
            <div class="year-e-reward">
                <h2 class="year-e-tit position-rel">
                    <div class="white text-center weight-bold position-rel">主播奖励</div>
                    <span class="bg-white position-abs"></span>
                </h2>
                <div class="year-e-rewarddel">
                    <img class="block img" src="images/demoimages/pic198_2.png" alt="" />
                    <img class="block img" src="images/demoimages/pic199_2.png" alt="" />
                    <img class="block img" src="images/demoimages/pic200_2.png" alt="" />
                </div>
                <p class="year-e-rewardtip white text-center">奖励将于次周周三前统一进行发放</p>
            </div>
            <!-- 用户奖励 -->
            <div class="year-e-userreward">
                <h2 class="year-e-tit position-rel">
                    <div class="white text-center weight-bold position-rel">用户奖励</div>
                    <span class="bg-white position-abs"></span>
                </h2>
                <div class="year-e-uwcon">
                    <div class="year-e-uwdel">
                        <h3 class="white text-center weight-bold thirty-two">年度忠实粉丝</h3>
                        <ul class="year-e-uwul">
                            <li class="year-e-uwli">
                                <div>
                                    <img class="block img" src="images/demoimages/pic196.png" alt="" />
                                </div>
                                <span class="block twenty-six text-center white">专属评论小尾巴<br />（终身）</span>
                            </li>
                            <li class="year-e-uwli">
                                <div>
                                    <img class="block img" src="images/demoimages/pic197.png" alt="" />
                                </div>
                                <span class="block twenty-six text-center white">主播守护<br />（终身）</span>
                            </li>
                        </ul>
                    </div>
                    <p class="text-center white">赠与在本次活动中贡献最多星光值的5位粉丝</p>
                </div>
            </div>
            <!-- 底部 -->
            <div class="year-e-foot white text-center">更多详询客服 微信：meisuilive   QQ：965997888<br />本活动最终解释权归美岁直播所有</div>
            <!-- 错误提示弹窗 -->
            <div class="jinj-fadealert text-center thirty white position-fix none">系统忙</div>
        </div>
        <script src="js/jquery-1.11.3.min.js" type="text/javascript"></script>
        <script src="js/index.js" type="text/javascript"></script>
        <script>
            // 视频 
            function pubVids (pubEve, strEve, vidEve, spanEve, noneEve) {
                var pubVid = $(vidEve)[0];
                var progress = $(strEve)
                $(pubEve).click(function() {
                    if ($(spanEve).hasClass(noneEve)) {
                        pubVid.pause();
                        $(spanEve).removeClass(noneEve);
                    } else {
                        pubVid.play();
                        $(spanEve).addClass(noneEve);
                    }
                })
                // 进度条功能实现
                pubVid.addEventListener("timeupdate", showTime);
                function showTime() {
                    progress.children().css({
                        "width": pubVid.currentTime / pubVid.duration * 100 + "%"
                    })
                    if ((pubVid.currentTime / pubVid.duration * 100) >= 100) {
                        pubVid.currentTime = 0;
                        pubVid.pause();
                        $(spanEve).removeClass(noneEve);
                    }
                }
                // 监听视频是否已经暂停
                pubVid.addEventListener("pause", pauseMonitor);
                function pauseMonitor () {
                    $(spanEve).removeClass(noneEve);
                }
                // 监听视频是否已经播放
                pubVid.addEventListener("play", playMonitor);
                function playMonitor () {
                    $(spanEve).addClass(noneEve);
                }
            }
            pubVids(".year-e-play", ".year-e-vrate", ".year-e-playvideo", ".year-e-playbut", "none")

            var serverUrl = "http://10.0.0.170:8080/"; // 域名
            var imgUrl = "https://web.source.meisuitv.com/"
            var datedel = new Date(); // 获取当前时间
            var dateYear = datedel.getFullYear(); // 年
            var dateMonth = datedel.getUTCMonth() + 1; // 月
            var dateDate = datedel.getDate(); // 日
            var weekDel = 1; // 当前时间是周几，默认周一
            var oneDay = 86400000; // 一天多少毫秒

            function resData (typenum, dateNum, firstRequest, weekItemSel) {
                $.ajax({
                    url: serverUrl + "meisuishare/yearendceremony/getList",
                    type: 'get',
                    dataType: 'json',
                    data: {
                        type: typenum,
                        date: dateNum
                    },
                    success: function (res) {
                        console.log(res)
                        if (res.sign = 1) {
                            var resDel = res.d;
                            if (firstRequest) {
                                weekDel = resDel.day;
                            }
                            var parentIndex = parseInt($(".year-e-lmnavitemsel").attr("data-type")); // 获取分类列表类型
                            if (parentIndex == 0) {
                                $(".year-e-lmweek div").eq(weekItemSel).addClass("year-e-lmweeksel")
                                $(".year-e-lmweek div").eq(weekItemSel).siblings().removeClass("year-e-lmweeksel")
                            } else {
                                if (resDel.day == 0) {
                                    $(".year-e-lmtime div").eq(6).addClass("year-e-lmtimesel")
                                    $(".year-e-lmtime div").eq(6).siblings().removeClass("year-e-lmtimesel");
                                } else {
                                    $(".year-e-lmtime div").eq(resDel.day - 1).addClass("year-e-lmtimesel")
                                    $(".year-e-lmtime div").eq(resDel.day - 1).siblings().removeClass("year-e-lmtimesel");
                                }
                            }

                            var resList = resDel.list;
                            var listCon = "";
                            if (resList == "") {
                                $(".year-e-lmul").addClass("none")
                                $(".year-e-lmnostart").removeClass("none")
                            } else {
                                $(".year-e-lmul").removeClass("none")
                                $(".year-e-lmnostart").addClass("none")
                                for (var i = 0; i < resList.length; i++) {
                                    listCon += '<li class="year-e-lmli"><span class="thirty">' + resList[i].rank + '</span><img class="block" src="' + imgUrl + resList[i].head + '" alt="" /><div class="thirty">' + resList[i].nickname + '</div><em class="twenty-six">' + resList[i].starlight + '</em></li>'
                                };
                                $(".year-e-lmul").empty("");
                                $(".year-e-lmul").append(listCon);
                            }
                        } else if(res.sign = 0) {
                            $(".jinj-fadealert").html("系统忙");
                            $(".jinj-fadealert").fadeIn(300, function() {
                                $(".bea-con-fadealert").fadeOut(2800);
                            });
                        }
                    }
                })
            }
            resData(1, dateYear + '-' + dateMonth + '-' + dateDate, true)

            // 点击切换女神榜
            $(".year-e-lmnavitem").click(function (e) {
                $(this).addClass("year-e-lmnavitemsel");
                $(this).siblings().removeClass("year-e-lmnavitemsel")
                var parentIndex = parseInt($(".year-e-lmnavitemsel").attr("data-type")); // 获取分类列表类型
                if (parentIndex == 0) {
                    // 切换子选择项
                    $(".year-e-lmtime").addClass("none")
                    $(".year-e-lmweek").removeClass("none")
                    // 重置回当前默认的选项
                    resData(parentIndex, dateYear + '-' + dateMonth + '-' + dateDate, false, 0)
                } else {
                    // 切换子选择项
                    $(".year-e-lmtime").removeClass("none")
                    $(".year-e-lmweek").addClass("none")
                    // 重置回当前默认的选项
                    resData(parentIndex, dateYear + '-' + dateMonth + '-' + dateDate, false)
                }
            });
            // 日期切换选择
            function itemSel (itemEve, selClass) {
                $(itemEve).click(function (e) {
                    // 选中框选中当前选项
                    $(this).addClass(selClass);
                    $(this).siblings().removeClass(selClass)

                    var parentIndex = parseInt($(".year-e-lmnavitemsel").attr("data-type")) // 获取分类列表类型
                    if (parentIndex == 0) {
                        // data-week: 0为本周，1为上周
                        var currentIndex = parseInt($(this).attr("data-week"));
                        if(currentIndex == 0) {
                            resData(parentIndex, dateYear + '-' + dateMonth + '-' + dateDate, false, currentIndex)
                        } else if(currentIndex == 1) {
                            var newDate = new Date(datedel - (7 * oneDay))
                            var newdateYear = newDate.getFullYear(); // 年
                            var newdateMonth = newDate.getUTCMonth() + 1; // 月
                            var newdateDate = newDate.getDate(); // 日
                            console.log(newdateYear + '-' + newdateMonth + '-' + newdateDate)
                            resData(parentIndex, newdateYear + '-' + newdateMonth + '-' + newdateDate, false, currentIndex)
                        }
                    } else {
                        var currentIndex = parseInt($(this).attr("data-week"));
                        if (currentIndex > weekDel) {
                            console.log("大于当前")
                            var differDay = currentIndex - weekDel;
                            var newDate = new Date(datedel - ((7 - differDay) * oneDay))
                        } else if(currentIndex <= weekDel) {
                            console.log("小于或等于当前")
                            var differDay = weekDel - currentIndex;
                            var newDate = new Date(datedel - (differDay * oneDay))
                        }
                        var newdateYear = newDate.getFullYear(); // 年
                        var newdateMonth = newDate.getUTCMonth() + 1; // 月
                        var newdateDate = newDate.getDate(); // 日
                        console.log(newdateYear + '-' + newdateMonth + '-' + newdateDate)
                        resData(parentIndex, newdateYear + '-' + newdateMonth + '-' + newdateDate, false)
                    }
                    
                });
            }
            itemSel(".year-e-lmtime div", "year-e-lmtimesel")
            itemSel(".year-e-lmweek div", "year-e-lmweeksel")

            // 星动女神榜模块滚动
            zbscroll("year-e-lmlists", "#year-e-lmlists", "#year-e-lmul", 1, 50);
            function zbscroll (idEve, outerlayer, inlayer, speed, intervaltime) {
                // 星动女神榜模块滚动
                var luckMain = document.getElementById(idEve);
                var luckSpeed = speed;
                var luckScroll = setInterval(function (){
                    if (luckMain.scrollTop + $(outerlayer).height() >= $(inlayer).height()) {
                        clearInterval(luckScroll);
                        setTimeout(function () {
                            luckMain.scrollTop += luckSpeed;
                            // 滚动到底部时重新滚动
                            luckMain.scrollTop = 0;
                            zbscroll("year-e-lmlists", "#year-e-lmlists", "#year-e-lmul", 1, 50);
                        }, 1500)
                    } else if(luckMain.scrollTop + $(outerlayer).height() < $(inlayer).height() && luckMain.scrollTop == 0) {
                        clearInterval(luckScroll);
                        setTimeout(function () {
                            luckMain.scrollTop += luckSpeed;
                            zbscroll("year-e-lmlists", "#year-e-lmlists", "#year-e-lmul", 1, 50);
                        }, 1500)
                    } else {
                        luckMain.scrollTop += luckSpeed;
                    }
                }, intervaltime);
            }
        </script>
    </body>
</html>