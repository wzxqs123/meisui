<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>大转盘</title>
        <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
        <meta name="format-detection" content="telephone=no">
        <link rel="stylesheet" type="text/css" href="css/turntable.css">
        <style type="text/css">
            html, body {
                background: #ff0000;
            }
        </style>
    </head>
    <body>
        <div class="turntable-wrap position-rel">
            <!-- 转盘 -->
            <!-- <div class="position-rel" style="z-index:2;width:21.32rem;height:21.32rem;margin: 0 auto;background-color:#f2b354;border-radius:50%;"></div> -->
            <div class="main position-rel">
                <div class="wrap position-rel">
                    <div class="frame">
                        <div class="circle">
                            <p class="position-rel" data-lottery="0">
                            </p>
                            <p class="position-rel" data-lottery="1">
                            </p>
                            <p class="position-rel" data-lottery="2">
                            </p>
                            <p class="position-rel" data-lottery="3">
                            </p>
                            <p class="position-rel" data-lottery="4">
                            </p>
                            <p class="position-rel" data-lottery="5">
                            </p>
                            <p class="position-rel" data-lottery="6">
                            </p>
                            <p class="position-rel" data-lottery="7">
                            </p>
                            <p class="position-rel" data-lottery="8">
                            </p>
                            <p class="position-rel" data-lottery="9">
                            </p>
                        </div>
                        <div class="button">
                            <button></button>
                            <p></p>
                        </div>
                    </div>
                    <div class="bubbles">
                        <span></span>
                        <span></span>
                        <span></span>
                        <span></span>
                        <span></span>
                        <span></span>
                        <span></span>
                        <span></span>
                        <span></span>
                        <span></span>
                        <span></span>
                        <span></span>
                    </div>
                    <mark class="white"></mark>
                    <div class="dialog">
                        <p></p>
                        <button>确定</button>
                    </div>
                </div>
                <div class="particle">
                    <span></span>
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
                <div class="luck-draw-tipalert position-abs text-center thirty-two none">大奖正在来的路上</div>
            </div>
            <div class="turntable-drawnum white weight-bold text-center">抽奖次数：<em>1</em></div>
            <p class="turntable-explain weight-bold turntable-red text-center">次数用完可以消费38Z币继续游戏！</p>
            <div class="turntable-but weight-bold thirty-two text-center clearfix">
                <a class="left" href="">抽奖纪录</a>
                <a class="right" href="">分享游戏</a>
            </div>
            <div class="turntable-winname">
                <div class="turntable-titname text-center">
                    <span class="thirty weight-bold white block">获奖名单</span>
                </div>
                <div class="turntable-seccon turntable-red bg-white">
                    <div class="turntable-sechead weight-bold text-center thirty-two clearfix">
                        <span class="left">用户昵称</span>
                        <span class="left">获得奖品</span>
                    </div>
                    <div id="turntable-list" class="turntable-list text-center twenty-six">
                        <div id="turntable-listcon" class="turntable-listcon">
                            <div class="turntable-listitem clearfix">
                                <span class="left">新年快乐</span>
                                <span class="left">3666积分</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="turntable-rule">
                <div class="turntable-titname text-center">
                    <span class="thirty weight-bold white block">游戏规则</span>
                </div>
                <ul class="turntable-rulecon bg-white">
                    <li>1.每天登陆即可获得一次抽奖机会。</li>
                    <li>2.成为白金会员每天可获得三次抽奖机会。</li>
                    <li>3.特别提示：抽取到实物奖励的用户记得确认自己填写的收货地址是否正确，因填写了错误的收货地址导致没有收到奖品概不负责</li>
                    <li>本活动最终解释权归赚赚所有。</li>
                    <li>客服微信：xxxxxxx</li>
                </ul>
            </div>
            <!-- 弹窗 -->
            <div class="turntable-alertbg position-fix ">
                <!-- 中奖的 -->
                <div class="turntable-alert bg-white text-center position-abs none">
                    <!-- <em class="turntable-close position-abs"></em> -->
                    <!-- 弹窗内容 -->
                    <em class="block weight-bold turntable-red">中奖啦！</em>
                    <p class="turntable-nofrequency turntable-red"></p>
                    <span class="block text-center weight-bold">知道了</span>
                </div>
                <!-- 不能玩的 -->
                <div class="turntable-wxts bg-white position-abs ">
                    <em class="turntable-wxtstit block weight-bold text-center turntable-red">温馨提示</em>
                    <!-- 删除twenty-four类 -->
                    <ol class="turntable-wxtscon turntable-red">
                        <li>登陆赚赚即送100Z币（只赠送一次），您可以使用100Z币进行游戏。若想继续游戏必须充值Z币。</li>
                        <li>若成为赚赚会员，即可每天免费赠送更多游戏机会。</li>
                    </ol>
                    <span class="turntable-wxtsbut block text-center weight-bold">知道了</span>
                </div>
            </div>
            <!-- 提示填写资料 -->
            <div class="index-promptbg position-fix none">
                <div class="index-prompt position-abs">
                    <div class="index-prompcon bg-white">
                        <p class="weight-bold">亲爱的赚友~<br>注册填写收货地址才能收到实<br>物奖励哦~</p>
                        <div class="index-prompbut text-center clearfix">
                            <a class="left white" href="">马上去</a>
                            <span class="left white">一会去</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <script src="js/jquery-1.11.3.min.js" type="text/javascript"></script>
        <script src="js/index.js" type="text/javascript"></script>
        <script>
            // 获奖公告滚屏
            noticescroll("turntable-list", "#turntable-list", "#turntable-listcon", 1, 50);
            function noticescroll (idEve, outerlayer, inlayer, speed, intervaltime) {
                // top魅力值模块滚动
                var luckMain = document.getElementById(idEve);
                var luckSpeed = speed;
                var luckScroll = setInterval(function (){
                    if (luckMain.scrollTop + $(outerlayer).height() >= $(inlayer).height() -1) {
                        clearInterval(luckScroll);
                        setTimeout(function () {
                            luckMain.scrollTop += luckSpeed;
                            // 滚动到底部时重新滚动
                            luckMain.scrollTop = 0;
                            noticescroll("turntable-list", "#turntable-list", "#turntable-listcon", 1, 50);
                        }, 1500)
                    } else if(luckMain.scrollTop + $(outerlayer).height() < $(inlayer).height() && luckMain.scrollTop == 0) {
                        clearInterval(luckScroll);
                        setTimeout(function () {
                            luckMain.scrollTop += luckSpeed;
                            noticescroll("turntable-list", "#turntable-list", "#turntable-listcon", 1, 50);
                        }, 1500)
                    } else {
                        luckMain.scrollTop += luckSpeed;
                    }
                }, intervaltime);
            }

            // 关闭弹窗
            function turntClose (butEve, alert, none) {
                $(butEve).click(function () {
                    $(alert).addClass(none);
                    // 解除滚动条锁定
                    relievescroll();
                })
            }
            // 点击确定按钮关闭弹窗
            turntClose(".turntable-alert span", ".turntable-alertbg", "none");
            // 点击关闭按钮关闭弹窗
            // turntClose(".turntable-close", ".turntable-alertbg", "none");
            // 点击弹窗空白部分隐藏弹窗
            freeBlank(".turntable-alertbg", ".turntable-alert", "none")

            $(function(){
                //var radius = $(window).width()/3;//半径
                var sum = 10;
                var loterry;//中奖的index,可将luckDrawArr[0]赋予loterry便是单抽的结果
                var minRotate = 2160;//最少转动角度
                var rotate = 0;
                var duration = 5;
                var $items = $(".circle p");
                var light = 0;
                var showTime,loterryTime,bubblesInterval;
                //var borderWidth = radius*Math.tan(360/sum/2*Math.PI/180);
                // $(".circle").css("width",radius*2+"px").css("height",radius*2+"px");
                $(".circle p").each(function(){
                   // $(this).css("border-width",radius+"px "+borderWidth+"px 0px "+borderWidth+"px");
                    //$(this).css("left",radius-borderWidth+"px");
                    var jiao = $(this).index()*360/sum;
                    $(this).css("transform","rotate("+jiao+"deg)");
                    //$(this).css("transform-origin",borderWidth+"px "+radius+"px");
                });
                // 点击单抽按钮
                function luckPumpBut (butEve, pumpEve) {
                    $(butEve).click(function(){
                        var turntCishu = parseInt($(".turntable-drawnum em").html());
                        if (turntCishu <= 0) {
                            $(".turntable-alertbg").removeClass("none");
                            $(".turntable-wxts").removeClass("none");
                            $(".turntable-alert").addClass("none");
                            // 锁定滚动条
                            lockscroll();
                        } else {
                            
                            // 剩余次数减一，并显示
                            turntCishu--;
                            $(".turntable-drawnum em").html(turntCishu);

                            $(this).addClass("disabled");
                            // loterry;
                            loterry = Math.floor(Math.random()*sum);//测试，随机一位数，为获奖的序号
                            rotate = rotate-rotate%360+minRotate+360-loterry*360/sum;//需要转动的角度
                            $(".circle").css("transform","rotate("+rotate+"deg)");
                            $(".circle").css("transition-duration",duration+"s");
                            $("body").addClass("playing");
                            pumpEve();
                            setTimeout(function(){
                                $("body").addClass("animate");
                            },1000);
                            setTimeout(function(){
                                $("body").removeClass("animate");
                            },duration*1000-1000);
                            loterryLight();
                            bubbles();
                        }

                    });
                    
                }
                luckPumpBut(".button", luckSinglePump);
                // 单抽转盘转动函数
                function luckSinglePump () {
                    setTimeout(function(){
                        /*if($items.eq(loterry).attr('data-lottery')){
                            dialog(true,"恭喜你中了"+$items.eq(loterry).attr('data-lottery')+"等奖");
                        }else{
                            dialog(true,"很遗憾你没有中奖");
                        }*/
                        /*0：3666积分
                        1：Iphone X
                        2：100Z币
                        3：500积分
                        4：300Z币
                        5：500元红包
                        6：20Z币
                        7：200积分
                        8：20Z币
                        9：100积分*/
                        var luckObtainNumber = $items.eq(loterry).attr('data-lottery');
                        // console.log($items.eq(loterry).attr('data-lottery'));
                        
                        $(".turntable-alertbg").removeClass("none");
                        $(".turntable-alert").removeClass("none");
                        $(".turntable-wxts").addClass("none");
                        if (luckObtainNumber == 0) {
                            $(".turntable-alert p").html("恭喜您获得了3666积分！")
                        } else if(luckObtainNumber == 1) {
                            $(".turntable-alert p").html("恭喜您获得了Iphone X！")
                        } else if(luckObtainNumber == 2) {
                            $(".turntable-alert p").html("恭喜您获得了100Z币！")
                        } else if(luckObtainNumber == 3) {
                            $(".turntable-alert p").html("恭喜您获得了500积分！")
                        } else if(luckObtainNumber == 4) {
                            $(".turntable-alert p").html("恭喜您获得了300Z币！")
                        } else if(luckObtainNumber == 5) {
                            $(".turntable-alert p").html("恭喜您获得了500元红包！")
                        } else if(luckObtainNumber == 6) {
                            $(".turntable-alert p").html("恭喜您获得了20Z币！")
                        } else if(luckObtainNumber == 7) {
                            $(".turntable-alert p").html("恭喜您获得了200积分！")
                        } else if(luckObtainNumber == 8) {
                            $(".turntable-alert p").html("恭喜您获得了20Z币！")
                        } else if(luckObtainNumber == 9) {
                            $(".turntable-alert p").html("恭喜您获得了100积分！")
                        }
                        // 锁定滚动条
                        lockscroll();

                        bubblesInterval&&clearInterval(bubblesInterval);
                        $(".button").removeClass("disabled");
                        $("body").removeClass("playing");
                    },duration*1000);
                }

                function show(){
                    loterryTime&&clearInterval(loterryTime);
                    bubblesInterval&&clearInterval(bubblesInterval);
                    showTime = setInterval(function(){
                        light = light%sum;
                        $items.removeClass("light");
                        $items.eq(light).addClass("light");
                        $items.eq((light+sum/2)%sum).addClass("light");
                        light++;
                    },500);
                }
                // show();
                function loterryLight(){
                    showTime&&clearInterval(showTime);
                    var step;//到达中奖的区域 需要移动的步数
                    if(light>=loterry){
                        step = loterry+sum-light;
                    }else{
                        step = loterry-light;
                    }
                    var stepAll = step+3*sum;
                    var time = (duration*1000-500)/stepAll;
                    lightAnimate(time,stepAll)();
                }
                function bubbles(){
                    var $bubbles = $(".bubbles span");
                    var index = 0;
                    bubblesInterval = setInterval(function(){
                        index = index%($bubbles.length);
                        $bubbles.removeClass("light");
                        $bubbles.eq(index).addClass("light");
                        index++;
                    },1.5/12*1000);
                }
                function lightAnimate(time,stepAll){
                    var step = 0,lightInterval;
                    return function(){
                        lightInterval = setInterval(function(){
                            light = light%sum;
                            $items.removeClass("light");
                            $items.eq(light).addClass("light");
                            if(step == stepAll){//已经转动到了中奖项
                                clearInterval(lightInterval);
                            }
                            light++;
                            step++;
                        },time);
                    };
                }
                $(".dialog button").click(function(){
                    dialog(false);
                });
                function dialog(bool,txt){
                    if(bool){
                        $(".dialog").removeClass("hide").addClass("show").find("p").html(txt);
                    }else{
                        $(".dialog").removeClass("show").addClass("hide");
                    }
                }
            });
            // 点击一会去关闭提示弹窗
            $(".index-prompbut span").click(function () {
                $(".index-promptbg").addClass("none");
            })
        </script>
    </body>
</html>